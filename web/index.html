<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta httpEquiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no" />
  <title>Карта и чат для постов ДПС в реальном времени в Кингисеппе</title>
  
  <!-- Telegram WebApp Script -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- PWA Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="ДПС Кингисепп">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#007AFF">
  
  <style>
    :root {
      --tg-viewport-height: 100vh;
      --tg-theme-bg-color: #ffffff;
      --tg-theme-text-color: #000000;
      --tg-theme-hint-color: #999999;
      --tg-theme-link-color: #007AFF;
      --tg-theme-button-color: #007AFF;
      --tg-theme-button-text-color: #ffffff;
      --tg-theme-secondary-bg-color: #f2f2f7;
    }
    
    html, body {
      height: 100%;
      height: var(--tg-viewport-height, 100vh);
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'SF Pro Display', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow: hidden;
      position: fixed;
      width: 100%;
      top: 0;
      left: 0;
    }
    
    #root {
      height: 100%;
      height: var(--tg-viewport-height, 100vh);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    /* Telegram WebApp specific styles */
    body {
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
    }
    
    /* Disable text selection and context menu for better app feel */
    * {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Allow text selection for inputs and text areas */
    input, textarea, [contenteditable] {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* Loading screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--tg-theme-bg-color);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--tg-theme-hint-color);
      border-top: 3px solid var(--tg-theme-button-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="loading" class="loading-screen">
    <div class="loading-spinner"></div>
  </div>
  <div id="root"></div>
  
  <script>
    // Initialize Telegram WebApp
    let telegramWebApp = null;
    
    if (window.Telegram && window.Telegram.WebApp) {
      telegramWebApp = window.Telegram.WebApp;
      
      // Apply Telegram theme
      if (telegramWebApp.themeParams) {
        const root = document.documentElement;
        Object.keys(telegramWebApp.themeParams).forEach(key => {
          const cssVar = `--tg-theme-${key.replace(/_/g, '-')}`;
          root.style.setProperty(cssVar, telegramWebApp.themeParams[key]);
        });
      }
      
      // Set viewport height for mobile
      if (telegramWebApp.viewportHeight) {
        document.documentElement.style.setProperty('--tg-viewport-height', telegramWebApp.viewportHeight + 'px');
      }
      
      // Handle viewport changes
      telegramWebApp.onEvent('viewportChanged', function() {
        if (telegramWebApp.viewportHeight) {
          document.documentElement.style.setProperty('--tg-viewport-height', telegramWebApp.viewportHeight + 'px');
        }
      });
      
      // Handle theme changes
      telegramWebApp.onEvent('themeChanged', function() {
        if (telegramWebApp.themeParams) {
          const root = document.documentElement;
          Object.keys(telegramWebApp.themeParams).forEach(key => {
            const cssVar = `--tg-theme-${key.replace(/_/g, '-')}`;
            root.style.setProperty(cssVar, telegramWebApp.themeParams[key]);
          });
        }
      });
      
      console.log('Telegram WebApp инициализирован:', {
        version: telegramWebApp.version,
        platform: telegramWebApp.platform,
        colorScheme: telegramWebApp.colorScheme,
        themeParams: telegramWebApp.themeParams,
        initDataUnsafe: telegramWebApp.initDataUnsafe,
        viewportHeight: telegramWebApp.viewportHeight
      });
      
      // Готовим WebApp
      telegramWebApp.ready();
      
      // Расширяем на весь экран
      telegramWebApp.expand();
      
    } else {
      console.log('Не запущено в Telegram WebApp окружении');
    }
    
    // Hide loading screen when app is ready
    window.addEventListener('load', function() {
      setTimeout(function() {
        const loading = document.getElementById('loading');
        if (loading) {
          loading.style.opacity = '0';
          loading.style.transition = 'opacity 0.3s ease';
          setTimeout(function() {
            loading.style.display = 'none';
          }, 300);
        }
      }, 1000);
    });
    
    // Prevent zoom on double tap
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
    
    // Prevent context menu
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
  </script>
</body>
</html>