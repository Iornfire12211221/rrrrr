#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ö–∏–Ω–≥–∏—Å–µ–ø–ø –î–ü–° –ª–æ–∫–∞–ª—å–Ω–æ..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ bun
if ! command -v bun &> /dev/null; then
    echo "‚ùå Bun –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º..."
    curl -fsSL https://bun.sh/install | bash
    source ~/.bashrc
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ expo
if ! command -v npx expo &> /dev/null; then
    echo "‚ùå Expo CLI –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
    bun install
fi

echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
bun install

echo "üîß –°–±–æ—Ä–∫–∞ –≤–µ–±-–≤–µ—Ä—Å–∏–∏..."
npx expo export --platform web

if [ $? -eq 0 ]; then
    echo "‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞!"
    echo "üåê –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:8081"
    echo ""
    echo "üì± –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
    echo "   ‚Ä¢ –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8081 –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
    echo "   ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ '–í–æ–π—Ç–∏ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ'"
    echo "   ‚Ä¢ –ò–ª–∏ –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –≤ Expo Go"
    echo ""
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    NODE_ENV=production bun run backend/hono.ts
else
    echo "‚ùå –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏!"
    exit 1
fi